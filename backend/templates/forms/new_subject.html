{% extends "base.html" %}

{% block content %}
    <div class="container">
        <h1>New Subject</h1>
        <form action="" method="post">
            <h3 class="form-heading">List a new subject</h3>
            <div class="form-group">
                <label for="name">Name</label>
                {{ form.name(class_ = 'form-control', id="name", autofocus = true) }}
            </div>
            <div class="form-group">
                <label for="grade">Grade</label>
                {{ form.grade(class_ = 'form-control', id="grade", autofocus = true) }}
            </div>
            <button class="btn btn-primary" id="submit" onclick="submit_input();">Create Subject</button>
        </form>
    </div>

    {% endblock %}

    {% block script %}

    <script>

        function submit_input() {

            var name = document.getElementById("name");
            var grade = document.getElementById("grade");
            printf('Name: ', name)
            var entry = {
                name: name.value,
                grade: grade.value
            };

            fetch(`${window.location.origin}/subjects/create`, {
                method: 'POST',
                body: JSON.stringify(entry),
                headers: new Headers({
                    'Content-Type': 'application/json',
                })
            })
                .then((response) => {
                    if (response.status !== 200) {
                        console.log(`Looks like there was a problem. Status code: ${response.status}`);
                        return;
                    }
                    response.json().then(function (data) {
                        console.log(data);
                    });
                })
                .then((myJson) => {
                    if (myJson['success'] == true) {
                        window.location.href = '/subjects';
                    }
                })
                .catch(function (error) {
                    console.log("Fetch error: " + error);
                });
        }
    </script>

    {% endblock %}